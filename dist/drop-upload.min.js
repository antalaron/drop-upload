/*!
 * DropUpload
 * https://github.com/antalaron/drop-upload
 *
 * (c) Antal √Åron <antalaron@antalaron.hu>
 *
 * Released under the MIT license
 */
!function(e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():window.DropUpload=e()}(function(){"use strict";var e=function(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var o in n)t[o]=n[o]}return t};Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&t.nodeType===Node.ELEMENT_NODE);return null});var t=function(e,t,r,a){null===e?n(t,r,a):o(e,t,r,a)},n=function(e,t,n){for(var o=document.querySelectorAll(e),r=0;r<o.length;++r){o[r].addEventListener(t,n)}},o=function(e,t,n,o){var r;r=document===e?[e]:document.querySelectorAll(e);for(var a=0;a<r.length;++a){r[a].addEventListener(n,function(e){null!==e.target.closest(t)&&o(e)})}},r=function(e,t,n){if(void 0===n)var n=[e.value.substring(0,e.selectionStart),e.value.substring(e.selectionEnd,e.value.length)];return e.value=n[0]+t()+n[1],e.selectionEnd=e.value.length-n[1].length,n};return function(){function n(){var o,a,l;if(0===arguments.length)throw"At least one argument required";1===arguments.length?(o=null,a=arguments[0],l={}):2===arguments.length&&"object"==typeof arguments[1]?(o=null,a=arguments[0],l=arguments[1]):2===arguments.length?(o=arguments[0],a=arguments[1],l={}):(o=arguments[0],a=arguments[1],l=arguments[2]),l=e(n.options,l),t(o,a,"dragover",function(e){e.preventDefault(),e.stopPropagation()}),t(o,a,"dragenter",function(e){e.preventDefault(),e.stopPropagation()}),t(o,a,"drop",function(e){e.preventDefault();var t=e.dataTransfer,n=t.files[0],o=e.target,a=new CustomEvent("drop-upload:start",{bubbles:!0,detail:{originalEvent:e}});o.dispatchEvent(a);var u=new FormData;u.append(l.uploadKey,n);var i=new XMLHttpRequest,s=r(o,function(){return l.uploadingCallback(n.name)});i.ontimeout=function(t){var n=new CustomEvent("drop-upload:timeout",{bubbles:!0,detail:{originalEvent:e,reason:"timeout"}});o.dispatchEvent(n)},i.timeout=l.timeout,i.open("POST",l.uploadPath),i.onreadystatechange=function(t){if(4===i.readyState){var a=!1,u="";if(0!==i.status)try{var c=l.decodeResponseCallback(t.currentTarget.response);if(!1===c)throw Error("Decode error")}catch(e){a=!0,u=e.message}else a=!0,u="Communication error";if(a){var d=new CustomEvent("drop-upload:error",{bubbles:!0,detail:{originalEvent:e,reason:u}});o.dispatchEvent(d),r(o,function(){return""},s)}else{var d=new CustomEvent("drop-upload:success",{bubbles:!0,detail:{originalEvent:e,fileName:n.name,path:c}});o.dispatchEvent(d),r(o,function(){return l.uploadedCallback(n.name,c)},s)}var d=new CustomEvent("drop-upload:end",{bubbles:!0,detail:{originalEvent:e,success:!a}});o.dispatchEvent(d)}},i.send(u)})}return n.options={uploadPath:"/upload",uploadKey:"file",uploadingCallback:function(e){return"![Uploading "+e+"]()"},uploadedCallback:function(e,t){return"!["+e+"]("+t+")"},decodeResponseCallback:function(e){return e},timeout:0},n}()});