/*! drop-upload v0.1.2 | Antal √Åron | MIT */
!function(e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():window.DropUpload=e()}(function(){"use strict";var o=function(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var o in n)t[o]=n[o]}return t};Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&t.nodeType===Node.ELEMENT_NODE);return null});var r=function(e,t,n,o){null===e?a(t,n,o):l(e,t,n,o)},a=function(e,t,n){for(var o=document.querySelectorAll(e),r=0;r<o.length;++r){o[r].addEventListener(t,n)}},l=function(e,t,n,o){var r;r=document===e?[e]:document.querySelectorAll(e);for(var a=0;a<r.length;++a){r[a].addEventListener(n,function(e){null!==e.target.closest(t)&&o(e)})}},d=function(e,t,n){if(void 0===n)n=[e.value.substring(0,e.selectionStart),e.value.substring(e.selectionEnd,e.value.length)];return e.value=n[0]+t()+n[1],e.selectionEnd=e.value.length-n[1].length,n};return function(){function n(){var e,t,i;if(0===arguments.length)throw"At least one argument required";1===arguments.length?(e=null,t=arguments[0],i={}):2===arguments.length&&"object"==typeof arguments[1]?(e=null,t=arguments[0],i=arguments[1]):2===arguments.length?(e=arguments[0],t=arguments[1],i={}):(e=arguments[0],t=arguments[1],i=arguments[2]),i=o(n.options,i),r(e,t,"dragover",function(e){e.preventDefault(),e.stopPropagation()}),r(e,t,"dragenter",function(e){e.preventDefault(),e.stopPropagation()}),r(e,t,"drop",function(a){a.preventDefault();var l=a.dataTransfer.files[0],u=a.target,e=new CustomEvent("drop-upload:start",a);u.dispatchEvent(e);var t=new FormData;t.append(i.uploadKey,l);var c=new XMLHttpRequest,s=d(u,function(){return i.uploadingCallback(l.name)});c.open("POST",i.uploadPath),c.onreadystatechange=function(e){if(4===c.readyState){var t,n=!1,o="";if(200===c.status)try{var r=i.decodeResponseCallback(e.currentTarget.response);if(!1===r)throw Error("Decode error")}catch(e){n=!0,o=e.message}else n=!0,o="Communication: "+c.status+" "+c.statusText;n?((t=new CustomEvent("drop-upload:error",a)).reason=o,u.dispatchEvent(t),d(u,function(){return""},s)):((t=new CustomEvent("drop-upload:success",a)).fileName=l.name,t.path=r,u.dispatchEvent(t),d(u,function(){return i.uploadedCallback(l.name,r)},s)),(t=new CustomEvent("drop-upload:end",a)).success=!n,u.dispatchEvent(t)}},c.send(t)})}return n.options={uploadPath:"/upload",uploadKey:"file",uploadingCallback:function(e){return"![Uploading "+e+"]()"},uploadedCallback:function(e,t){return"!["+e+"]("+t+")"},decodeResponseCallback:function(e){return e}},n}()});