/*! drop-upload v0.1.3 | Antal √Åron | MIT */
!function(e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():window.DropUpload=e()}(function(){"use strict";var o=function(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var o in n)t[o]=n[o]}return t};Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&t.nodeType===Node.ELEMENT_NODE);return null});var r=function(e,t,n,o){null===e?a(t,n,o):u(e,t,n,o)},a=function(e,t,n){for(var o=document.querySelectorAll(e),r=0;r<o.length;++r){o[r].addEventListener(t,n)}},u=function(e,t,n,o){var r;r=document===e?[e]:document.querySelectorAll(e);for(var a=0;a<r.length;++a){r[a].addEventListener(n,function(e){null!==e.target.closest(t)&&o(e)})}},d=function(e,t,n){if(void 0===n)n=[e.value.substring(0,e.selectionStart),e.value.substring(e.selectionEnd,e.value.length)];return e.value=n[0]+t()+n[1],e.selectionEnd=e.value.length-n[1].length,n};return function(){function n(){var e,t,s;if(0===arguments.length)throw"At least one argument required";1===arguments.length?(e=null,t=arguments[0],s={}):2===arguments.length&&"object"==typeof arguments[1]?(e=null,t=arguments[0],s=arguments[1]):2===arguments.length?(e=arguments[0],t=arguments[1],s={}):(e=arguments[0],t=arguments[1],s=arguments[2]),s=o(n.options,s),r(e,t,"dragover",function(e){e.preventDefault(),e.stopPropagation()}),r(e,t,"dragenter",function(e){e.preventDefault(),e.stopPropagation()}),r(e,t,"drop",function(a){a.preventDefault();var u=a.dataTransfer.files[0],l=a.target,e=new CustomEvent("drop-upload:start",a);l.dispatchEvent(e);var t=new FormData;t.append(s.uploadKey,u);var i=new XMLHttpRequest,c=d(l,function(){return s.uploadingCallback(u.name)});i.ontimeout=function(e){var t=new CustomEvent("drop-upload:timeout",a);t.reason="timeout",l.dispatchEvent(t)},i.timeout=s.timeout,i.open("POST",s.uploadPath),i.onreadystatechange=function(e){if(4===i.readyState){var t,n=!1,o="";if(0!==i.status)try{var r=s.decodeResponseCallback(e.currentTarget.response);if(!1===r)throw Error("Decode error")}catch(e){n=!0,o=e.message}else n=!0,o="Communication error";n?((t=new CustomEvent("drop-upload:error",a)).reason=o,l.dispatchEvent(t),d(l,function(){return""},c)):((t=new CustomEvent("drop-upload:success",a)).fileName=u.name,t.path=r,l.dispatchEvent(t),d(l,function(){return s.uploadedCallback(u.name,r)},c)),(t=new CustomEvent("drop-upload:end",a)).success=!n,l.dispatchEvent(t)}},i.send(t)})}return n.options={uploadPath:"/upload",uploadKey:"file",uploadingCallback:function(e){return"![Uploading "+e+"]()"},uploadedCallback:function(e,t){return"!["+e+"]("+t+")"},decodeResponseCallback:function(e){return e},timeout:0},n}()});