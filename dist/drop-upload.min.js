/*! drop-upload v0.1.1 | Antal √Åron | MIT */
!function(e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():window.DropUpload=e()}(function(){"use strict";var o=function(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var o in n)t[o]=n[o]}return t};Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&t.nodeType===Node.ELEMENT_NODE);return null});var a=function(e,t,n,o){e.addEventListener(n,function(e){null!==e.target.closest(t)&&o(e)})},i=function(e,t,n){if(void 0===n)n=[e.value.substring(0,e.selectionStart),e.value.substring(e.selectionEnd,e.value.length)];return e.value=n[0]+t()+n[1],e.selectionEnd=e.value.length-n[1].length,n};return function(){function n(e,t,c){c=o(n.options,c),a(e,t,"dragover",function(e){e.preventDefault(),e.stopPropagation()}),a(e,t,"dragenter",function(e){e.preventDefault(),e.stopPropagation()}),a(e,t,"drop",function(r){r.preventDefault();var u=r.dataTransfer.files[0],l=r.target,e=new CustomEvent("drop-upload:start",r);l.dispatchEvent(e);var t=new FormData;t.append(c.uploadKey,u);var s=new XMLHttpRequest,p=i(l,function(){return c.uploadingCallback(u.name)});s.open("POST",c.uploadPath),s.onreadystatechange=function(e){if(4===s.readyState){var t,n=!1,o="";if(200===s.status){var a=c.decodeResponseCallback(e.currentTarget.response);!1===a&&(n=!0,o="Decode")}else n=!0,o="Communication: "+s.status+" "+s.statusText;n?((t=new CustomEvent("drop-upload:error",r)).reason=o,l.dispatchEvent(t),i(l,function(){return""},p)):((t=new CustomEvent("drop-upload:success",r)).fileName=u.name,t.path=a,l.dispatchEvent(t),i(l,function(){return c.uploadedCallback(u.name,a)},p)),(t=new CustomEvent("drop-upload:end",r)).success=!n,l.dispatchEvent(t)}},s.send(t)})}return n.options={uploadPath:"/upload",uploadKey:"file",uploadingCallback:function(e){return"![Uploading "+e+"]()"},uploadedCallback:function(e,t){return"!["+e+"]("+t+")"},decodeResponseCallback:function(e){return e}},n}()});